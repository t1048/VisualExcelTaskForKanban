# VisualExcelTaskForKanban

Excel のタスク一覧を読み込み、ドラッグ&ドロップ可能なカンバンボードとして可視化するデスクトップアプリケーションです。PyWebView を介してローカル HTML を表示し、Excel ファイルの編集・保存、データ検証（入力規則）の同期、ファイル変更の自動反映までを Python バックエンドで担います。タスクはカンバン／リスト／タイムラインの 3 画面で閲覧・編集できます。

## ディレクトリ構成

```
VisualExcelTaskForKanban/
├─ backend/              # Python バックエンド
├─ data/                 # サンプルの Excel データなど
├─ frontend/
│  ├─ pages/             # HTML エントリーポイント（カンバン／リスト／タイムライン）
│  ├─ scripts/           # フロントエンドの JavaScript
│  └─ styles/            # 各画面のスタイルシート
├─ tools/                # 実行補助スクリプト
├─ LICENSE
└─ README.md
```

## 主な画面と機能

### カンバンボード (`frontend/pages/index.html`)
- Excel (`data/task.xlsx`) の各行をカードとして表示し、ステータス列ごとに整理。
- ステータス列上でのドラッグ&ドロップによる進捗更新と即時反映。
- タスク追加・編集・削除モーダル（ステータス／大分類／中分類／担当者／優先度／期限／備考を編集可能）。
- 担当者／大分類・中分類／ステータス複数選択／キーワード／期限（期間・以前・以後）でのフィルタリング。
- 期限切れ・期限間近タスクのハイライトと件数サマリーをツールバーに表示。
- 優先度列の昇順ソート（数値・文字列どちらも対応）。
- Excel のデータ検証（プルダウン）設定を読み取り、ステータス候補や優先度などを自動で同期。
- 入力規則（候補値）の編集 UI からステータス／カテゴリ／担当者候補を一括更新し、保存時に Excel 側のデータ検証も上書き。

### リストビュー (`frontend/pages/list.html`)
- すべてのタスクをテーブル形式で俯瞰し、ヘッダークリックやキーボード操作で No／大分類／中分類／タスク／ステータス／担当者／期限などをソート。
- ステータス順・優先度・期限のハイライトを加味した既定並びで簡易レポートとして利用可能。
- カテゴリバッジや期限バッジで視認性を高め、ダブルクリックで直接編集モーダルを開けます。
- カンバンと同じフィルター（担当者・カテゴリ・ステータス複数選択・キーワード・期限）と件数サマリーを共有。

### タイムラインビュー (`frontend/pages/timeline.html`)
- 担当者単位でタスクを縦軸に、日付を横軸に並べた簡易ガントチャート風表示。
- 表示期間の指定（任意の日付範囲、今週・前週・翌週などのクイック選択）。
- 担当者フィルターやステータス別凡例付きで、担当者ごとの稼働状況を俯瞰。
- いずれのタスクもその場で編集モーダルから更新可能で、保存すると即座に反映されます。

### Excel 連携とリアルタイム更新
- 標準列は `No / ステータス / 大分類 / 中分類 / タスク / 担当者 / 優先度 / 期限 / 備考`。不足列は自動追加されます。
- 保存時は Excel のデータ検証を上書きし、ステータスやカテゴリ候補も同期。
- 保存ごとにタイムスタンプ付きバックアップ（`.bak_YYYYMMDD_HHMMSS.xlsx`）を同ディレクトリへ自動作成。
- watchdog によるファイル監視で、Excel を外部で更新するとアプリへ自動プッシュされます（ネットワークドライブ向けポーリング監視にも対応）。

## 動作環境

| 項目 | 内容 |
| ---- | ---- |
| OS | Windows / macOS / Linux （PyWebView が動作する環境） |
| Python | 3.10 以上を推奨（`str \| None` などのシンタックスを使用） |
| Excel | `data/task.xlsx` を含む任意の .xlsx ファイル |

### 必要な Python パッケージ

```
pip install pandas openpyxl pywebview watchdog
```

※ Windows で WebView2 ランタイムが未導入の場合は [Microsoft Edge WebView2](https://developer.microsoft.com/microsoft-edge/webview2/#download-section) のインストールが必要になることがあります。

## 実行方法

1. 上記パッケージをインストールした Python 仮想環境を用意します。
2. `data/task.xlsx`（または自分の Excel ファイルを `data/` 配下へコピーしたもの）を用意します。
3. 次のコマンドでバックエンドを起動します。

```bash
python backend/backend.py --excel ./data/task.xlsx --html ./frontend/pages/index.html
```

PyWebView ウィンドウが開き、カンバンボードが表示されます。ツールバーの「保存」で Excel へ書き戻し、「再読込」で Excel から最新状態を再読み込みします。

### 開発者向けヒント

- HTML をブラウザで直接開くとモックデータが表示され、PyWebView なしでも UI の確認ができます。
- Excel の変更監視が不要な場合は `--no-watch` を指定してください。ネットワークドライブなどは `--watch-polling` とポーリング間隔オプションで調整できます。

### コマンドライン引数

`backend.py` では以下のオプションが利用できます。

| 引数 | 既定値 | 説明 |
| ---- | ------ | ---- |
| `--excel` | `./data/task.xlsx` | 読み込む Excel ファイルのパス |
| `--sheet` | なし | 読み込むシート名（未指定時は先頭シート） |
| `--html` | `./frontend/pages/index.html` | 表示するフロントエンド HTML のパス |
| `--title` | `タスク・ボード` | ウィンドウタイトル |
| `--width` | `1280` | ウィンドウ幅（ピクセル） |
| `--height` | `800` | ウィンドウ高さ（ピクセル） |
| `--debug` | `False` | PyWebView のデバッグモードを有効化（開発時向け） |
| `--no-watch` | `False` | Excel ファイルの変更監視を無効化 |
| `--watch-polling` | `False` | ファイル監視に PollingObserver を利用（ネットワークドライブ向け） |
| `--watch-interval` | `1.0` | PollingObserver 利用時のポーリング間隔（秒） |
| `--watch-debounce` | `2.0` | アプリ自身の保存直後に発生するイベントを無視する猶予時間（秒） |

### Windows 用バッチ

Windows で Miniconda を利用している場合は、`tools/VisualExcelTaskForKanban.bat` を編集して利用することで、仮想環境の有効化とアプリ起動をまとめて行えます。

### Excel ファイルの自動監視

- バックエンドは [watchdog](https://pypi.org/project/watchdog/) を利用して Excel ファイルの変更を常時監視し、保存を検知すると自動で `load_excel()` を実行します。
- 監視で取得した最新データは PyWebView 経由でフロントエンドへプッシュされ、手動の「再読込」操作なしでボードが更新されます。
- 監視が不要な場合は `--no-watch` を指定してください。ネットワークドライブなどの環境では `--watch-polling`（必要に応じて `--watch-interval`）でポーリング監視へ切り替えられます。
- アプリの保存直後に発生する監視イベントは `--watch-debounce` で指定した秒数だけ無視されるため、無限ループで再読込されることはありません。
- 動作確認はアプリ起動中に Excel を外部で編集・保存し、数秒後にボードへ自動反映されることを確認してください。

## ここが便利！

- **Excel のままチーム共有**: 既存の Excel ファイルをそのまま利用しつつ、アプリ側で列不足を補完し、保存時にはバックアップも自動生成するので安心です。
- **マルチビューで状況把握**: カンバン／リスト／タイムラインの 3 つの観点で同じタスクを確認でき、状況に応じて最適な画面を選べます。
- **リアルタイム同期**: ファイル監視により Excel の更新が即座に各画面へ反映され、ステータス候補や優先度の入力規則もワンクリックで更新できます。

## ライセンス

このリポジトリは [MIT License](./LICENSE) の下で公開されています。
